@model YTE.Common.DTOS.PaginatedList<YTE.BusinessLogic.Implementation.ArtReview.Model.ListArtReviewModel>
@inject YTE.Common.DTOS.CurrentUserDto CurrentUser

<h1 class="py-3">Reviews for @if (Model.Count() > 0)
{ <i>@Model.First().ArtName</i>}
else { <i> an object with no reviews</i>}</h1>


<table class="table">
    <thead>
        <tr>
            <th>
                UserName
            </th>
            <th>
                Image
            </th>
            <th>
                Review
            </th>
            <th>
                Experienced at
            </th>
            <th>
                <a asp-action="ListReviewsOfArt" asp-route-sortOrder="@ViewData["DateSortParm"]"asp-route-currentFilter="@ViewData["CurrentFilter"]">Date of review</a>
            </th>
            <th>
                <a asp-action="ListReviewsOfArt" asp-route-sortOrder="@ViewData["ScoreSortParm"]"asp-route-currentFilter="@ViewData["CurrentFilter"]">Score</a>
            </th>
            <th></th>
        </tr>
    </thead>
    
        @if (Model.Count == 0)
        {
            <i>No Reviews yet</i>
        }
        else
        {
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @item.UserName
                    </td>
                    <td>
                        <img src="@item.Image" width="100" height="100" />
                    </td>
                    <td id="shorten">
                        @item.Review
                    </td>
                    <td>
                        @item.ExperiencedAt.ToShortDateString()
                    </td>
                    <td>
                        @item.Date.ToShortDateString()
                    </td>
                    <td>
                        @item.Score
                    </td>
                    <td>

                        @{
                            if (CurrentUser.Id == item.UserId || CurrentUser.Roles.Contains("Admin"))
                            {
                                <a class="btn btn-outline-dark" href="/ArtReview/Edit/@item.ArtObjectId/@item.UserName">Edit</a>
                                <br />
                                <span id="confirmDeleteSpan_@item.UserName" style="display:none">
                                    <span>Are you sure you want to delete?</span>
                                    <a href="/ArtReview/Delete/@item.ArtObjectId/@item.UserName" type="submit" class="btn btn-danger">Yes</a>
                                    <a style="cursor:pointer"class="btn btn-primary" onclick="confirmDelete('@item.UserName', false)">No</a>
                                </span>
                                <span id="deleteSpan_@item.UserName">
                                    <a style="cursor:pointer" class="btn btn-outline-danger" onclick="confirmDelete('@item.UserName',true)">Delete</a>
                                </span>

                            }

                        }

                    </td>
                </tr>
            }
        </tbody>
        }
</table>
@{
    var prevDisabled = !Model.PreviousPage ? "disabled" : "";
    var nextDisabled = !Model.NextPage ? "disabled" : "";
}

<a asp-action="ListReviewsOfArt"
   asp-route-sortOrder="@ViewData["CurrentSort"]"
   asp-route-pageNumber="@(Model.PageIndex - 1)"
   asp-route-currentFilter="@ViewData["CurrentFilter"]"
   class="btn btn-default @prevDisabled">
    Previous
</a>
<a asp-action="ListReviewsOfArt"
   asp-route-sortOrder="@ViewData["CurrentSort"]"
   asp-route-pageNumber="@(Model.PageIndex + 1)"
   asp-route-currentFilter="@ViewData["CurrentFilter"]"
   class="btn btn-default @nextDisabled">
    Next
</a>
@section Scripts {
    <script src="~/js/jquery-shorten.js"></script>
    <script src="~/js/apply-shorten.js"></script>
    <script src="~/js/delete.js"></script>
}
